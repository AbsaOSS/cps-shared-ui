<div class="cps-input-container" [ngStyle]="{ width: cvtWidth }">
  @if (label) {
    <div
      class="cps-input-label"
      [ngClass]="{ 'cps-input-label-disabled': disabled && !readonly }">
      <label>{{ label }}</label>
      @if (infoTooltip) {
        <cps-info-circle
          class="cps-input-label-info-circle"
          size="xsmall"
          [tooltipPosition]="infoTooltipPosition"
          [tooltipContentClass]="infoTooltipClass"
          [tooltipMaxWidth]="infoTooltipMaxWidth"
          [tooltipPersistent]="infoTooltipPersistent"
          [tooltipText]="infoTooltip">
        </cps-info-circle>
      }
    </div>
  }

  <div
    class="cps-input-wrap"
    [ngClass]="{
      password: type === 'password',
      'cps-input-wrap-error': error,
      clearable: clearable,
      'persistent-clear': persistentClear,
      borderless: appearance === 'borderless',
      underlined: appearance === 'underlined'
    }">
    @if (!valueToDisplay) {
      <input
        spellcheck="false"
        [type]="currentType"
        autocomplete="off"
        [value]="value"
        (input)="updateValueEvent($event)"
        [placeholder]="placeholder"
        [disabled]="disabled"
        [readonly]="readonly"
        (keydown.enter)="onInputEnterKeyDown()"
        [ngStyle]="{
          width: cvtWidth,
          'padding-left': prefixWidth || 'none'
        }"
        (blur)="onBlur()"
        (focus)="onFocus()" />
    }

    @if (valueToDisplay) {
      <input
        [value]="valueToDisplay"
        [disabled]="true"
        [readonly]="true"
        [ngStyle]="{
          width: cvtWidth,
          'padding-left': prefixWidth || 'none'
        }" />
    }

    <div class="cps-input-prefix">
      @if (prefixIcon) {
        <span class="cps-input-prefix-icon">
          <cps-icon
            [icon]="prefixIcon"
            [size]="prefixIconSize"
            [style.color]="disabled ? '#9a9595' : null"
            [style.cursor]="
              prefixIconClickable && !disabled && !readonly
                ? 'pointer'
                : 'default'
            "
            (click)="onClickPrefixIcon()">
          </cps-icon>
        </span>
      }

      @if (prefixText) {
        <span class="cps-input-prefix-text" #prefixTextSpan>
          {{ prefixText }}
        </span>
      }
    </div>

    @if (!disabled && !readonly) {
      <div class="cps-input-action-btns">
        @if (clearable) {
          <span
            [style.visibility]="
              persistentClear || (!persistentClear && value)
                ? 'visible'
                : 'hidden'
            "
            class="clear-btn">
            <cps-icon icon="delete" size="small" (click)="onClear()"></cps-icon>
          </span>
        }
        @if (type === 'password') {
          <span
            class="password-show-btn"
            [ngClass]="{ 'password-show-btn-active': currentType === 'text' }">
            <cps-icon
              icon="eye"
              size="18px"
              (click)="togglePassword()"></cps-icon>
          </span>
        }
      </div>
    }
    @if (loading) {
      <cps-progress-linear
        height="3"
        radius="4"
        opacity="0.3"
        class="cps-input-progress-bar"
        bgColor="transparent">
      </cps-progress-linear>
    }
  </div>
  @if (!error && !hideDetails) {
    <div class="cps-input-hint">
      {{ hint }}
    </div>
  }
  @if (error && !hideDetails) {
    <div class="cps-input-error">
      {{ error }}
    </div>
  }
</div>
