<div class="cps-table-col-filter">
  <cps-menu
    #columnFilterMenu
    [withArrow]="false"
    hideTransitionOptions="0s linear"
    [persistent]="persistent || (showApplyButton && isCategoryDropdownOpened)"
    (menuShown)="onMenuShown()"
    (menuHidden)="onMenuHidden()"
    (beforeMenuHidden)="onBeforeMenuHidden()">
    <div class="cps-table-col-filter-menu-content">
      @if (showCloseButton || headerTitle) {
        <div
          class="cps-table-col-filter-menu-content-header"
          >
          <span class="cps-table-col-filter-menu-content-header-title">
            {{ headerTitle }}
          </span>
          @if (showCloseButton) {
            <cps-icon
              icon="close-x"
            (click)="onCloseClick()"></cps-icon>
          }
        </div>
      }
      @if (isShowOperator) {
        <div
          class="cps-table-col-filter-menu-content-operator"
          >
          <cps-select
            [hideDetails]="true"
            [disabled]="!fieldConstraints || fieldConstraints.length < 2"
            [returnObject]="false"
            [options]="operatorOptions"
            [ngModel]="operator"
          (valueChanged)="onOperatorChange($event)"></cps-select>
        </div>
      }
      <div class="cps-table-col-filter-menu-content-constraints">
        @for (fieldConstraint of fieldConstraints; track fieldConstraint; let i = $index) {
          <div
            class="cps-table-col-filter-menu-content-constraint">
            @if (showMatchModes && currentMatchModes) {
              <cps-select
                class="cps-table-col-filter-match-mode-select"
                [hideDetails]="true"
                [returnObject]="false"
                [options]="currentMatchModes"
                [ngModel]="fieldConstraint.matchMode"
            (valueChanged)="
              onMenuMatchModeChange($event, fieldConstraint)
            "></cps-select>
            }
            <table-column-filter-constraint
              #constraintComponent
              [type]="type"
              [field]="field"
              [asButtonToggle]="asButtonToggle"
              [singleSelection]="singleSelection"
              [categoryOptions]="categoryOptions"
              [filterConstraint]="fieldConstraint"
              [hasApplyButton]="showApplyButton"
              [placeholder]="placeholder">
            </table-column-filter-constraint>
            @if (showRemoveIcon) {
              <div
                class="cps-table-col-filter-remove-rule-btn"
                >
                <cps-button
                  type="borderless"
                  width="100%"
                  size="small"
                  color="prepared"
                  icon="delete"
                  (clicked)="removeConstraint(fieldConstraint)"
                  label="Remove condition">
                </cps-button>
              </div>
            }
          </div>
        }
      </div>
      @if (isShowAddConstraint) {
        <div
          class="cps-table-col-filter-add-rule-btn"
          >
          <cps-button
            label="Add condition"
            type="borderless"
            width="100%"
            size="small"
            color="surprise"
            icon="add"
            (clicked)="addConstraint()">
          </cps-button>
        </div>
      }
      <div class="cps-table-col-filter-buttonbar">
        @if (showClearButton) {
          <cps-button
            (clicked)="clearFilter()"
            type="borderless"
            color="prepared"
            size="small"
          label="Clear"></cps-button>
        }
        @if (showApplyButton) {
          <cps-button
            (clicked)="applyFilter()"
            color="prepared"
            size="small"
          label="Apply"></cps-button>
        }
      </div>
    </div>
  </cps-menu>
  <cps-icon
    [icon]="isFilterApplied ? 'filter-funnel-filled' : 'filter-funnel'"
    size="13"
    (click)="columnFilterMenu.toggle($event)"
    class="cps-table-col-filter-menu-button"
    [ngClass]="{
      'cps-table-col-filter-menu-button-active': isFilterApplied
    }"
    >>
  </cps-icon>
</div>
