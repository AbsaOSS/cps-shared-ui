<p-table
  #primengTable
  withUnsort
  [styleClass]="styleClass"
  [value]="data"
  [columns]="selectedColumns"
  (selectionChange)="onSelectionChanged($event)"
  [resizableColumns]="resizableColumns"
  [reorderableColumns]="reorderableColumns"
  [globalFilterFields]="globalFilterFields"
  [scrollable]="scrollable"
  [scrollHeight]="scrollHeight"
  [lazy]="lazy"
  [lazyLoadOnInit]="lazyLoadOnInit"
  [virtualScroll]="virtualScroll"
  [virtualScrollItemSize]="virtualScrollItemSize"
  [virtualScrollOptions]="{ numToleratedItems: 3 }"
  [paginator]="paginator"
  [showCurrentPageReport]="true"
  [alwaysShowPaginator]="alwaysShowPaginator"
  [rows]="rows"
  [first]="first"
  [totalRecords]="totalRecords"
  currentPageReportTemplate="{first} - {last} of {totalRecords}"
  [(selection)]="selectedRows"
  [metaKeySelection]="false"
  [rowHover]="rowHover"
  [customSort]="customSort"
  [sortMode]="sortMode"
  (onPage)="onPageChange($event)"
  (sortFunction)="onSortFunction($event)">
  <ng-template pTemplate="caption" *ngIf="hasToolbar">
    <ng-container *ngIf="toolbarTemplate">
      <ng-container *ngTemplateOutlet="toolbarTemplate"></ng-container>
    </ng-container>
    <ng-container *ngIf="!toolbarTemplate">
      <div class="cps-table-tbar-left">
        <div>{{ toolbarTitle }}</div>
        <div *ngIf="showGlobalFilter" class="cps-table-tbar-global-filter">
          <cps-input
            prefixIcon="search"
            [placeholder]="globalFilterPlaceholder"
            (valueChanged)="onFilterGlobal($event)"
            [clearable]="true"
            [hideDetails]="true">
          </cps-input>
        </div>
      </div>
      <div class="cps-table-tbar-right">
        <div
          *ngIf="showRemoveBtnOnSelect && selectedRows.length > 0"
          class="cps-table-tbar-remove-btn">
          <cps-button
            label="Remove"
            color="prepared"
            type="borderless"
            icon="remove"
            (clicked)="removeSelected()">
          </cps-button>
        </div>
        <div *ngIf="showActionBtn" class="cps-table-tbar-action-btn">
          <cps-button
            [label]="actionBtnTitle"
            color="prepared"
            type="outlined"
            (clicked)="onClickActionBtn()">
          </cps-button>
        </div>
        <div
          *ngIf="showColumnsToggle && columns.length > 0"
          class="cps-table-tbar-coltoggle-btn">
          <cps-icon
            icon="columns"
            size="normal"
            color="prepared-lighten1"
            (click)="colToggleMenu.toggle($event)"></cps-icon>
          <cps-menu #colToggleMenu [withArrow]="false">
            <div class="cps-table-coltoggle-menu">
              <div
                class="cps-table-coltoggle-menu-item select-all-option"
                [class.allselected]="selectedColumns.length === columns.length"
                (click)="toggleAllColumns()">
                <span class="cps-table-coltoggle-menu-item-left">
                  <span class="cps-table-coltoggle-menu-item-check"> </span>
                  <span class="cps-table-coltoggle-menu-item-label"
                    >Show all columns</span
                  >
                </span>
              </div>
              <div
                *ngFor="let col of columns"
                class="cps-table-coltoggle-menu-item"
                (click)="onSelectColumn(col)"
                [class.selected]="isColumnSelected(col)">
                <span class="cps-table-coltoggle-menu-item-left">
                  <span class="cps-table-coltoggle-menu-item-check"></span>
                  <span class="cps-table-coltoggle-menu-item-label">{{
                    col[colHeaderName]
                  }}</span>
                </span>
              </div>
            </div>
          </cps-menu>
        </div>
      </div>
    </ng-container>
  </ng-template>

  <ng-template pTemplate="header" let-columns>
    <tr>
      <th style="width: 3rem" *ngIf="reorderableRows"></th>
      <th style="width: 4rem" *ngIf="selectable">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      <ng-container *ngIf="headerTemplate">
        <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>
      </ng-container>
      <ng-container *ngIf="!headerTemplate">
        <ng-container *ngIf="columns.length > 0">
          <th *ngFor="let col of columns">
            {{ col[colHeaderName] }}
          </th>
        </ng-container>
        <ng-container *ngIf="headers.length > 0 && columns.length < 1">
          <th *ngFor="let h of headers">{{ h }}</th>
        </ng-container>
      </ng-container>
    </tr>
  </ng-template>

  <ng-template
    pTemplate="body"
    let-rowData
    let-columns="columns"
    let-item
    let-rowIndex="rowIndex">
    <tr
      [pReorderableRow]="rowIndex"
      [ngClass]="{
        'cps-table-row-selected': selectable && primengTable.isSelected(item)
      }">
      <td *ngIf="reorderableRows">
        <span pReorderableRowHandle>â˜°</span>
      </td>
      <td *ngIf="selectable">
        <p-tableCheckbox [value]="item"></p-tableCheckbox>
      </td>
      <ng-container *ngIf="bodyTemplate">
        <ng-container
          pTemplate="body"
          *ngTemplateOutlet="
            bodyTemplate;
            context: { $implicit: item, rowIndex: rowIndex }
          ">
        </ng-container>
      </ng-container>
      <ng-container *ngIf="!bodyTemplate">
        <ng-container *ngIf="columns.length > 0">
          <td *ngFor="let col of columns">
            {{ rowData[col[colFieldName]] }}
          </td>
        </ng-container>
      </ng-container>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="100" class="cps-table-empty-message-td">
        {{ emptyMessage }}
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="paginatorleft">
    <div class="cps-table-paginator-itms-per-page">
      <span class="cps-table-paginator-items-per-page-title"
        >Rows per page:
      </span>
      <cps-select
        [options]="rowOptions"
        [hideDetails]="true"
        [(ngModel)]="rows"
        (valueChanged)="onRowsPerPageChanged()"
        [returnObject]="false">
      </cps-select>
    </div>
  </ng-template>
</p-table>
